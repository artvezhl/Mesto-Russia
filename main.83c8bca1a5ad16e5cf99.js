!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e,t,s){},function(e,t,s){"use strict";s.r(t);s(0);const r=document.querySelector(".popup-container"),i=document.querySelector(".user-info__edit-button"),o=document.querySelector(".user-info__button"),n=document.querySelector(".user-info__name"),a=document.querySelector(".user-info__job"),c=document.querySelector(".user-info__photo");class h{constructor(e){this.setEventListeners=()=>{this._form.addEventListener("input",e=>{this.checkInputValidity(e),this.setSubmitButtonState()})},this._form=e}checkInputValidity(e){const t=e.target,s=t.nextElementSibling;t.setCustomValidity(""),t.validity.valueMissing&&t.setCustomValidity("Это обязательное поле"),(t.validity.tooShort||t.validity.tooLong)&&t.setCustomValidity("Должно быть от 2 до 30 символов"),t.validity.typeMismatch&&t.setCustomValidity("Здесь должна быть ссылка"),s.textContent=t.validationMessage}setSubmitButtonState(){this._form.querySelector(".button").disabled=!this._form.checkValidity()}}class l{constructor(e){this._container=e}_toggle(){this._container.classList.toggle("popup_is-opened")}open(){this._toggle()}close(){this._toggle()}}class d extends l{constructor(e){super(e),this.open=e=>{super.open(),this._link=e.target.getAttribute("style").slice(22,-2).replace(/"/g,""),this._popupContent.querySelector(".popup__image").setAttribute("src",""+this._link),this._container.appendChild(this._popupContent),this._popupContent.querySelector(".popup__close").addEventListener("click",this.close)},this.close=()=>{super.close(),this._container.removeChild(this._popupContent),this._popupContent.querySelector(".popup__close").removeEventListener("click",this.close)},this._popupContent=d._template.cloneNode(!0).children[0]}}d._template=document.querySelector("#image-popup").content;class u extends l{constructor(e,t,s,r){super(e),this.open=()=>{super.open(),this._container.appendChild(this._popupContent),this._popupContent.querySelector(".popup__close").addEventListener("click",this.close),this.form=document.forms.edit,this.name=this.form.name,this.about=this.form.about,this.name.value=this.userInfoObj.name,this.about.value=this.userInfoObj.info,this._setListeners(),this.formValidator(this.form).setEventListeners(),this.form.querySelector(".button").setAttribute("disabled","true")},this._setListeners=()=>{this.form.addEventListener("submit",this._handleEditFormSubmit)},this._handleEditFormSubmit=e=>{e.preventDefault();const t=document.querySelector(".popup__button_place_profile");t.textContent="Загрузка...",this._api.editUserInfo(this.name.value,this.about.value).then(e=>{this.userInfoObj.setUserInfo(e.name,e.about),t.textContent="Сохранить",this.close()}).catch(e=>console.log(e))},this.close=()=>{super.close(),this._container.removeChild(this._popupContent),this._popupContent.querySelector(".popup__close").removeEventListener("click",this.close),this._resetFormErrors()},this._popupContent=u._template.cloneNode(!0).children[0],this.userInfoObj=t,this.formValidator=s,this._api=r}_resetFormErrors(){const[...e]=this.form.querySelectorAll(".error-message");e.forEach(e=>{e.textContent=""})}}u._template=document.querySelector("#edit-info-popup").content;class _{constructor(e,t,s){this._setListeners=()=>{this._card.querySelector(".place-card__like-icon").addEventListener("click",this._cardLikeHandler),this._card.querySelector(".place-card__delete-icon").addEventListener("click",this._remove),this._card.querySelector(".place-card__image").addEventListener("click",this._popupOpenHandler)},this._cardLikeHandler=e=>{e.target.classList.contains("place-card__like-icon_liked")?this._removeLike(e):this._like(e)},this._like=e=>{const t=e.target.closest("div.place-card").getAttribute("data-id");e.preventDefault(),this._api.setLike(t).then(t=>{e.target.classList.toggle("place-card__like-icon_liked"),this._cardLikes.textContent=t.likes.length}).catch(e=>console.log(e))},this._removeLike=e=>{const t=e.target.closest("div.place-card").getAttribute("data-id");e.preventDefault(),this._api.removeLike(t).then(t=>{e.target.classList.toggle("place-card__like-icon_liked"),this._cardLikes.textContent=t.likes.length}).catch(e=>console.log(e))},this._removeListeners=()=>{this._card.querySelector(".place-card__like-icon").removeEventListener("click",this._like),this._card.querySelector(".place-card__delete-icon").removeEventListener("click",this._remove),this._card.querySelector(".place-card__image").removeEventListener("click",this._popupOpenHandler)},this._remove=e=>{e.stopPropagation(),e.preventDefault();const t=e.target.closest(".places-list"),s=e.target.closest("div.place-card"),r=s.getAttribute("data-id");window.confirm("Вы действительно хотите удалить эту карточку?")&&this._api.removeCard(r).then(()=>{this._removeListeners(),t.removeChild(s)}).catch(e=>console.log(e))},this._data=e,this._popupOpenHandler=t,this._api=s}create(){this._card=_._template.cloneNode(!0).children[0],this._card.querySelector(".place-card__name").textContent=this._data.name;const e=this._card.querySelector(".place-card__like-icon");this._cardLikes=this._card.querySelector(".place-card__like-number"),this._likes=this._data.likes,this._likes?this._cardLikes.textContent=this._likes.length:this._cardLikes.textContent=0;const t=this._card.querySelector(".place-card__delete-icon");return this._data.owner&&"bed1ef91b1eb9c081562b68f"===this._data.owner._id&&t.setAttribute("style","display: block"),this._likes.find(e=>"bed1ef91b1eb9c081562b68f"===e._id)&&e.classList.add("place-card__like-icon_liked"),this._card.setAttribute("data-id",""+this._data._id),this._cardImage=this._card.querySelector(".place-card__image"),this._cardImage.style.backgroundImage=`url(${this._data.link})`,this._setListeners(),this._card}createNewCard(){return this._card=_._template.cloneNode(!0).children[0],this._card.querySelector(".place-card__name").textContent=this._data.name,this._cardLikes=this._card.querySelector(".place-card__like-number"),this._cardLikes.textContent=0,this._card.querySelector(".place-card__delete-icon").setAttribute("style","display: block"),this._card.setAttribute("data-id",""+this._data._id),this._cardImage=this._card.querySelector(".place-card__image"),this._cardImage.style.backgroundImage=`url(${this._data.link})`,this._setListeners(),this._card}}_._template=document.querySelector("#card-template").content;class p extends l{constructor(e,t,s,r){super(e),this.open=()=>{super.open(),this._container.appendChild(this._popupContent),this._popupContent.querySelector(".popup__close").addEventListener("click",this.close),this.form=document.forms.new,this.form.addEventListener("submit",this._handleAddCardSubmit),this.formValidator(this.form).setEventListeners(),this.form.querySelector(".button").setAttribute("disabled","true")},this._handleAddCardSubmit=e=>{e.preventDefault();const t=document.querySelector(".popup__button");t.textContent="Загрузка...",this._api.addNewCard(this.form.name.value,this.form.link.value).then(e=>{this.cardlist.addNewCard(e),t.textContent="+",this._resetForm(),this.close()}).catch(e=>console.log(e))},this.close=()=>{super.close(),this._container.removeChild(this._popupContent),this._popupContent.querySelector(".popup__close").removeEventListener("click",this.close),this._resetFormErrors()},this._popupContent=p._template.cloneNode(!0).children[0],this.cardlist=t,this.formValidator=s,this._api=r}_resetForm(){this.form.reset()}_resetFormErrors(){const[...e]=this.form.querySelectorAll(".error-message");e.forEach(e=>{e.textContent=""})}}p._template=document.querySelector("#add-card-popup").content;class m extends l{constructor(e,t,s,r){super(e),this.open=()=>{super.open(),this._container.appendChild(this._popupContent),this._popupContent.querySelector(".popup__close").addEventListener("click",this.close),this.form=document.forms.ava,this.form.addEventListener("submit",this._handleChangeAvaSubmit),this.formValidator(this.form).setEventListeners(),this.form.querySelector(".button").setAttribute("disabled","true")},this._handleChangeAvaSubmit=e=>{e.preventDefault(),console.log(this.form.link.value),this._api.changeAvatar(""+this.form.link.value).then(()=>{this._userInfo.setAvatar(""+this.form.link.value),this._resetForm(),this.close()}).catch(e=>console.log(e))},this.close=()=>{super.close(),this._container.removeChild(this._popupContent),this._popupContent.querySelector(".popup__close").removeEventListener("click",this.close),this._resetForm(),this._resetFormErrors()},this._popupContent=m._template.cloneNode(!0).children[0],this._userInfo=t,this.formValidator=s,this._api=r}_resetForm(){this.form.reset()}_resetFormErrors(){const[...e]=this.form.querySelectorAll(".error-message");e.forEach(e=>{e.textContent=""})}}m._template=document.querySelector("#change-avatar-popup").content;const f=new class{constructor(e){this._url=e.baseUrl,this._headers=e.headers}_getResponseData(e){return e.ok?e.json():Promise.reject("Ошибка: "+e.status)}getUserInfo(){return fetch(this._url+"/users/me",{headers:this._headers}).then(e=>this._getResponseData(e))}getInitialCards(){return fetch(this._url+"/cards",{headers:this._headers}).then(e=>this._getResponseData(e))}editUserInfo(e,t){return fetch(this._url+"/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>this._getResponseData(e))}addNewCard(e,t){return fetch(this._url+"/cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(e=>this._getResponseData(e))}removeCard(e){return fetch(`${this._url}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(e=>this._getResponseData(e))}setLike(e){return fetch(`${this._url}/cards/like/${e}`,{method:"PUT",headers:this._headers}).then(e=>this._getResponseData(e))}removeLike(e){return fetch(`${this._url}/cards/like/${e}`,{method:"DELETE",headers:this._headers}).then(e=>this._getResponseData(e))}changeAvatar(e){return fetch(this._url+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:""+e})}).then(e=>this._getResponseData(e))}}({baseUrl:"https://praktikum.tk/cohort11",headers:{authorization:"6a4cb1c5-9817-4f1e-b991-c86219eada0b","Content-Type":"application/json"}}),v=(...e)=>new h(...e),b=new d(r),g=new class{constructor(e,t,s){this._nameNode=e,this._aboutNode=t,this._avaNode=s}renderDefaultInfo(e){this.name=e.name,this.info=e.about,this.ava=e.avatar,this._nameNode.textContent=this.name,this._aboutNode.textContent=this.info,this._avaNode.style.backgroundImage=`url(${this.ava})`}setUserInfo(e,t){this.name=e,this.info=t,this.updateUserInfo()}updateUserInfo(){this._nameNode.textContent=this.name,this._aboutNode.textContent=this.info}setAvatar(e){this.ava=e,this.updateUserAva()}updateUserAva(){this._avaNode.style.backgroundImage=`url(${this.ava})`}}(n,a,c),y=new u(r,g,v,f),k=new class{constructor(e,t,s,r){this._container=e,this._card=t,this._openPopupMethod=s,this.api=r}addCard(e){this._container.appendChild(this._card(e,this._openPopupMethod,this.api).create()),this._container.querySelector(".place-card").setAttribute("data-id",""+e._id)}addNewCard(e){this._container.appendChild(this._card(e,this._openPopupMethod,this.api).createNewCard()),this._container.querySelector(".place-card").setAttribute("data-id",""+e._id)}render(e){e.forEach(e=>{this.addCard(e)})}}(document.querySelector(".places-list"),(...e)=>new _(...e),b.open,f),C=new p(r,k,v,f),S=new m(r,g,v,f);i.addEventListener("click",y.open),o.addEventListener("click",C.open),c.addEventListener("click",S.open),Promise.all([f.getUserInfo(),f.getInitialCards()]).then(e=>{const[t,s]=e;g.renderDefaultInfo(t),k.render(s)}).catch(e=>{console.log(e)})}]);